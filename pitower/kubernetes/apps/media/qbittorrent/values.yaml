controllers:
  qbittorrent:
    pod:
      securityContext:
        fsGroup: 2000
        fsGroupChangePolicy: "OnRootMismatch"
      terminationGracePeriodSeconds: 120

    containers:
      app:
        nameOverride: qbittorrent
        image:
          repository: ghcr.io/home-operations/qbittorrent
          tag: 5.1.4@sha256:e9c2c24ad2b39fa0ee44de682bf26b14bf23cffea1de9e1f082f26caed4277f9
        env:
          UMASK: "022"
          QBT_WEBUI_PORT: &port 8080

        probes:
          liveness:
            enabled: true
          readiness:
            enabled: true
          startup:
            enabled: true
            spec:
              failureThreshold: 30
              periodSeconds: 5
        resources:
          requests:
            cpu: 100m
            memory: 128Mi
          limits:
            memory: 8192Mi
        securityContext:
          runAsUser: 2000
          runAsGroup: 2000
          runAsNonRoot: true
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          capabilities:
            drop:
              - ALL

service:
  app:
    controller: qbittorrent
    ports:
      http:
        port: *port

ingress:
  app:
    className: internal
    hosts:
      - host: qbittorrent.pitower.link
        paths:
          - path: /
            service:
              identifier: app
              port: http

persistence:
  config:
    enabled: true
    existingClaim: qbittorrent-config
    advancedMounts:
      qbittorrent:
        app:
          - path: /config
  downloads:
    type: nfs
    server: data
    path: /volume1/media
    globalMounts:
      - path: /data/nas-media
        subPath: downloads/qbittorrent
